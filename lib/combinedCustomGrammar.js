"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.default = void 0;
var _necessary = require("necessary");
var _occamGrammarUtilities = require("occam-grammar-utilities");
var _defaultCustomGrammar = _interopRequireDefault(require("./defaultCustomGrammar"));
var _constants = require("./constants");
var _ruleName = require("./utilities/ruleName");
var _rules = require("./utilities/rules");
var _customGrammars = require("./utilities/customGrammars");
var _ruleNames = require("./ruleNames");
function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function");
    }
}
function _defineProperties(target, props) {
    for(var i = 0; i < props.length; i++){
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
    }
}
function _createClass(Constructor, protoProps, staticProps) {
    if (protoProps) _defineProperties(Constructor.prototype, protoProps);
    if (staticProps) _defineProperties(Constructor, staticProps);
    return Constructor;
}
function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
var first = _necessary.arrayUtilities.first, filter = _necessary.arrayUtilities.filter, unshift = _necessary.arrayUtilities.unshift;
var CombinedCustomGrammar = /*#__PURE__*/ function() {
    function CombinedCustomGrammar(lexicalPattern, ruleMap) {
        _classCallCheck(this, CombinedCustomGrammar);
        this.lexicalPattern = lexicalPattern;
        this.ruleMap = ruleMap;
    }
    _createClass(CombinedCustomGrammar, [
        {
            key: "getLexicalPattern",
            value: function getLexicalPattern() {
                return this.lexicalPattern;
            }
        },
        {
            key: "getRuleMap",
            value: function getRuleMap() {
                return this.ruleMap;
            }
        }
    ], [
        {
            key: "fromCustomGrammars",
            value: function fromCustomGrammars(customGrammars) {
                var metastatementRules = metastatementRulesFromCustomGrammarsAndDefaultBNF(customGrammars), statementRules = statementRulesFromCustomGrammarsAndDefaultBNF(customGrammars), expressionRules = expressionRulesFromCustomGrammarsAndDefaultBNF(customGrammars), termRules = termRulesFromCustomGrammarsAndDefaultBNF(customGrammars), rules = [].concat(metastatementRules).concat(statementRules).concat(expressionRules).concat(termRules), startRule = startRuleFromNothing(), lexicalPattern = lexicalPatternFromCustomGrammars(customGrammars), ruleMap = (0, _rules).ruleMapFromRules(rules);
                ruleMap[_ruleNames.START_RULE_NAME] = startRule;
                (0, _occamGrammarUtilities).eliminateLeftRecursion(startRule, ruleMap);
                delete ruleMap[_ruleNames.START_RULE_NAME];
                var combinedCustomGrammar = new CombinedCustomGrammar(lexicalPattern, ruleMap);
                return combinedCustomGrammar;
            }
        }
    ]);
    return CombinedCustomGrammar;
}();
exports.default = CombinedCustomGrammar;
function metastatementRulesFromCustomGrammarsAndDefaultBNF(customGrammars) {
    var metastatementRuleName = _ruleNames.METASTATEMENT_RULE_NAME, metastatementRules = rulesFromRuleNameCustomGrammarsAndDefaultBNF(metastatementRuleName, customGrammars);
    return metastatementRules;
}
function statementRulesFromCustomGrammarsAndDefaultBNF(customGrammars) {
    var statementRuleName = _ruleNames.STATEMENT_RULE_NAME, statementRules = rulesFromRuleNameCustomGrammarsAndDefaultBNF(statementRuleName, customGrammars);
    return statementRules;
}
function expressionRulesFromCustomGrammarsAndDefaultBNF(customGrammars) {
    var expressionRuleName = _ruleNames.EXPRESSION_RULE_NAME, expressionRules = rulesFromRuleNameCustomGrammarsAndDefaultBNF(expressionRuleName, customGrammars);
    return expressionRules;
}
function termRulesFromCustomGrammarsAndDefaultBNF(customGrammars) {
    var termRuleName = _ruleNames.TERM_RULE_NAME, termRules = rulesFromRuleNameCustomGrammarsAndDefaultBNF(termRuleName, customGrammars);
    return termRules;
}
function lexicalPatternFromCustomGrammars(customGrammars) {
    var lexicalPatterns = (0, _customGrammars).lexicalPatternsFromCustomGrammars(customGrammars), defaultCustomGrammarLexicalPattern = _defaultCustomGrammar.default.getLexicalPattern(), defaultLexicalPattern = defaultCustomGrammarLexicalPattern; ///
    lexicalPatterns.reverse();
    lexicalPatterns.push(defaultLexicalPattern);
    filter(lexicalPatterns, function(lexicalPattern) {
        if (lexicalPattern !== _constants.EMPTY_STRING) {
            return true;
        }
    });
    var lexicalPatternsString = lexicalPatterns.join("|"), lexicalPattern1 = "^(?:".concat(lexicalPatternsString, ")");
    return lexicalPattern1;
}
function startRuleFromNothing() {
    var startRulesBNF = " ".concat(_ruleNames.START_RULE_NAME, " ::= ").concat(_ruleNames.METASTATEMENT_RULE_NAME, " | ").concat(_ruleNames.STATEMENT_RULE_NAME, " | ").concat(_ruleNames.EXPRESSION_RULE_NAME, " | ").concat(_ruleNames.TERM_RULE_NAME, " ; "), startRules = (0, _rules).rulesFromBNF(startRulesBNF), firstStartRule = first(startRules), startRule = firstStartRule; ///
    return startRule;
}
function remainingRulesFromRulesAndMainRule(rules, mainRule) {
    var remainingRules = rules.filter(function(rule) {
        if (rule !== mainRule) {
            return true;
        }
    });
    return remainingRules;
}
function mainRuleFromRuleNameDefaultBNFAndBNFs(ruleName, bnfs) {
    var defaultCustomGrammarBNF = _defaultCustomGrammar.default.getBNF(ruleName), defaultBNF = defaultCustomGrammarBNF, defaultRules = (0, _rules).rulesFromBNF(defaultBNF), defaultMainRule = (0, _ruleName).findRuleByRuleName(ruleName, defaultRules), defaultMainRuleDefinitions = defaultMainRule.getDefinitions();
    bnfs.forEach(function(bnf) {
        var rules = (0, _rules).rulesFromBNF(bnf), mainRule = (0, _ruleName).findRuleByRuleName(ruleName, rules), mainRuleDefinitions = mainRule !== null ? mainRule.getDefinitions() : [];
        unshift(defaultMainRuleDefinitions, mainRuleDefinitions);
    });
    var mainRule1 = defaultMainRule; ///
    return mainRule1;
}
function remainingRulesFromRuleNameDefaultBNFAndBNFs(ruleName, bnfs) {
    var defaultCustomGrammarBNF = _defaultCustomGrammar.default.getBNF(ruleName), defaultBNF = defaultCustomGrammarBNF, defaultRules = (0, _rules).rulesFromBNF(defaultBNF), defaultMainRule = (0, _ruleName).findRuleByRuleName(ruleName, defaultRules), defaultRemainingRules = remainingRulesFromRulesAndMainRule(defaultRules, defaultMainRule);
    bnfs.forEach(function(bnf) {
        var rules = (0, _rules).rulesFromBNF(bnf), mainRule = (0, _ruleName).findRuleByRuleName(ruleName, rules), remainingRules = remainingRulesFromRulesAndMainRule(rules, mainRule);
        unshift(defaultRemainingRules, remainingRules);
    });
    var remainingRules1 = defaultRemainingRules; ///
    return remainingRules1;
}
function rulesFromRuleNameCustomGrammarsAndDefaultBNF(ruleName, customGrammars) {
    var bnfs = (0, _customGrammars).bnfsFromRuleNameAndCustomGrammars(ruleName, customGrammars), mainRule = mainRuleFromRuleNameDefaultBNFAndBNFs(ruleName, bnfs), remainingRules = remainingRulesFromRuleNameDefaultBNFAndBNFs(ruleName, bnfs), rules = [].concat(mainRule).concat(remainingRules);
    return rules;
}

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jb21iaW5lZEN1c3RvbUdyYW1tYXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbmltcG9ydCB7IGFycmF5VXRpbGl0aWVzIH0gZnJvbSBcIm5lY2Vzc2FyeVwiO1xuaW1wb3J0IHsgZWxpbWluYXRlTGVmdFJlY3Vyc2lvbiB9IGZyb20gXCJvY2NhbS1ncmFtbWFyLXV0aWxpdGllc1wiO1xuXG5pbXBvcnQgZGVmYXVsdEN1c3RvbUdyYW1tYXIgZnJvbSBcIi4vZGVmYXVsdEN1c3RvbUdyYW1tYXJcIjtcblxuaW1wb3J0IHsgRU1QVFlfU1RSSU5HIH0gZnJvbSBcIi4vY29uc3RhbnRzXCI7XG5pbXBvcnQgeyBmaW5kUnVsZUJ5UnVsZU5hbWUgfSBmcm9tIFwiLi91dGlsaXRpZXMvcnVsZU5hbWVcIjtcbmltcG9ydCB7IHJ1bGVzRnJvbUJORiwgcnVsZU1hcEZyb21SdWxlcyB9IGZyb20gXCIuL3V0aWxpdGllcy9ydWxlc1wiO1xuaW1wb3J0IHsgbGV4aWNhbFBhdHRlcm5zRnJvbUN1c3RvbUdyYW1tYXJzLCBibmZzRnJvbVJ1bGVOYW1lQW5kQ3VzdG9tR3JhbW1hcnMgfSBmcm9tIFwiLi91dGlsaXRpZXMvY3VzdG9tR3JhbW1hcnNcIjtcbmltcG9ydCB7IFNUQVJUX1JVTEVfTkFNRSwgVEVSTV9SVUxFX05BTUUsIEVYUFJFU1NJT05fUlVMRV9OQU1FLCBTVEFURU1FTlRfUlVMRV9OQU1FLCBNRVRBU1RBVEVNRU5UX1JVTEVfTkFNRSB9IGZyb20gXCIuL3J1bGVOYW1lc1wiO1xuXG5jb25zdCB7IGZpcnN0LCBmaWx0ZXIsIHVuc2hpZnQgfSA9IGFycmF5VXRpbGl0aWVzO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDb21iaW5lZEN1c3RvbUdyYW1tYXIge1xuICBjb25zdHJ1Y3RvcihsZXhpY2FsUGF0dGVybiwgcnVsZU1hcCkge1xuICAgIHRoaXMubGV4aWNhbFBhdHRlcm4gPSBsZXhpY2FsUGF0dGVybjtcbiAgICB0aGlzLnJ1bGVNYXAgPSBydWxlTWFwO1xuICB9XG4gIFxuICBnZXRMZXhpY2FsUGF0dGVybigpIHtcbiAgICByZXR1cm4gdGhpcy5sZXhpY2FsUGF0dGVybjtcbiAgfVxuXG4gIGdldFJ1bGVNYXAoKSB7XG4gICAgcmV0dXJuIHRoaXMucnVsZU1hcDtcbiAgfVxuXG4gIHN0YXRpYyBmcm9tQ3VzdG9tR3JhbW1hcnMoY3VzdG9tR3JhbW1hcnMpIHtcbiAgICBjb25zdCBtZXRhc3RhdGVtZW50UnVsZXMgPSBtZXRhc3RhdGVtZW50UnVsZXNGcm9tQ3VzdG9tR3JhbW1hcnNBbmREZWZhdWx0Qk5GKGN1c3RvbUdyYW1tYXJzKSxcbiAgICAgICAgICBzdGF0ZW1lbnRSdWxlcyA9IHN0YXRlbWVudFJ1bGVzRnJvbUN1c3RvbUdyYW1tYXJzQW5kRGVmYXVsdEJORihjdXN0b21HcmFtbWFycyksXG4gICAgICAgICAgZXhwcmVzc2lvblJ1bGVzID0gZXhwcmVzc2lvblJ1bGVzRnJvbUN1c3RvbUdyYW1tYXJzQW5kRGVmYXVsdEJORihjdXN0b21HcmFtbWFycyksXG4gICAgICAgICAgdGVybVJ1bGVzID0gdGVybVJ1bGVzRnJvbUN1c3RvbUdyYW1tYXJzQW5kRGVmYXVsdEJORihjdXN0b21HcmFtbWFycyksXG4gICAgICAgICAgcnVsZXMgPSBbXS5jb25jYXQobWV0YXN0YXRlbWVudFJ1bGVzKS5jb25jYXQoc3RhdGVtZW50UnVsZXMpLmNvbmNhdChleHByZXNzaW9uUnVsZXMpLmNvbmNhdCh0ZXJtUnVsZXMpLFxuICAgICAgICAgIHN0YXJ0UnVsZSA9IHN0YXJ0UnVsZUZyb21Ob3RoaW5nKCksXG4gICAgICAgICAgbGV4aWNhbFBhdHRlcm4gPSBsZXhpY2FsUGF0dGVybkZyb21DdXN0b21HcmFtbWFycyhjdXN0b21HcmFtbWFycyksXG4gICAgICAgICAgcnVsZU1hcCA9IHJ1bGVNYXBGcm9tUnVsZXMocnVsZXMpO1xuXG4gICAgcnVsZU1hcFtTVEFSVF9SVUxFX05BTUVdID0gc3RhcnRSdWxlO1xuXG4gICAgZWxpbWluYXRlTGVmdFJlY3Vyc2lvbihzdGFydFJ1bGUsIHJ1bGVNYXApO1xuXG4gICAgZGVsZXRlIHJ1bGVNYXBbU1RBUlRfUlVMRV9OQU1FXTtcblxuICAgIGNvbnN0IGNvbWJpbmVkQ3VzdG9tR3JhbW1hciA9IG5ldyBDb21iaW5lZEN1c3RvbUdyYW1tYXIobGV4aWNhbFBhdHRlcm4sIHJ1bGVNYXApO1xuICAgIFxuICAgIHJldHVybiBjb21iaW5lZEN1c3RvbUdyYW1tYXI7XG4gIH1cbn1cblxuZnVuY3Rpb24gbWV0YXN0YXRlbWVudFJ1bGVzRnJvbUN1c3RvbUdyYW1tYXJzQW5kRGVmYXVsdEJORihjdXN0b21HcmFtbWFycykge1xuICBjb25zdCBtZXRhc3RhdGVtZW50UnVsZU5hbWUgPSBNRVRBU1RBVEVNRU5UX1JVTEVfTkFNRSwgIC8vL1xuICAgICAgICBtZXRhc3RhdGVtZW50UnVsZXMgPSBydWxlc0Zyb21SdWxlTmFtZUN1c3RvbUdyYW1tYXJzQW5kRGVmYXVsdEJORihtZXRhc3RhdGVtZW50UnVsZU5hbWUsIGN1c3RvbUdyYW1tYXJzKTtcblxuICByZXR1cm4gbWV0YXN0YXRlbWVudFJ1bGVzO1xufVxuXG5mdW5jdGlvbiBzdGF0ZW1lbnRSdWxlc0Zyb21DdXN0b21HcmFtbWFyc0FuZERlZmF1bHRCTkYoY3VzdG9tR3JhbW1hcnMpIHtcbiAgY29uc3Qgc3RhdGVtZW50UnVsZU5hbWUgPSBTVEFURU1FTlRfUlVMRV9OQU1FLCAgLy8vXG4gICAgICAgIHN0YXRlbWVudFJ1bGVzID0gcnVsZXNGcm9tUnVsZU5hbWVDdXN0b21HcmFtbWFyc0FuZERlZmF1bHRCTkYoc3RhdGVtZW50UnVsZU5hbWUsIGN1c3RvbUdyYW1tYXJzKTtcblxuICByZXR1cm4gc3RhdGVtZW50UnVsZXM7XG59XG5cbmZ1bmN0aW9uIGV4cHJlc3Npb25SdWxlc0Zyb21DdXN0b21HcmFtbWFyc0FuZERlZmF1bHRCTkYoY3VzdG9tR3JhbW1hcnMpIHtcbiAgY29uc3QgZXhwcmVzc2lvblJ1bGVOYW1lID0gRVhQUkVTU0lPTl9SVUxFX05BTUUsICAvLy9cbiAgICAgICAgZXhwcmVzc2lvblJ1bGVzID0gcnVsZXNGcm9tUnVsZU5hbWVDdXN0b21HcmFtbWFyc0FuZERlZmF1bHRCTkYoZXhwcmVzc2lvblJ1bGVOYW1lLCBjdXN0b21HcmFtbWFycyk7XG5cbiAgcmV0dXJuIGV4cHJlc3Npb25SdWxlcztcbn1cblxuZnVuY3Rpb24gdGVybVJ1bGVzRnJvbUN1c3RvbUdyYW1tYXJzQW5kRGVmYXVsdEJORihjdXN0b21HcmFtbWFycykge1xuICBjb25zdCB0ZXJtUnVsZU5hbWUgPSBURVJNX1JVTEVfTkFNRSwgIC8vL1xuICAgICAgICB0ZXJtUnVsZXMgPSBydWxlc0Zyb21SdWxlTmFtZUN1c3RvbUdyYW1tYXJzQW5kRGVmYXVsdEJORih0ZXJtUnVsZU5hbWUsIGN1c3RvbUdyYW1tYXJzKTtcblxuICByZXR1cm4gdGVybVJ1bGVzO1xufVxuXG5mdW5jdGlvbiBsZXhpY2FsUGF0dGVybkZyb21DdXN0b21HcmFtbWFycyhjdXN0b21HcmFtbWFycykge1xuICBjb25zdCBsZXhpY2FsUGF0dGVybnMgPSBsZXhpY2FsUGF0dGVybnNGcm9tQ3VzdG9tR3JhbW1hcnMoY3VzdG9tR3JhbW1hcnMpLFxuICAgICAgICBkZWZhdWx0Q3VzdG9tR3JhbW1hckxleGljYWxQYXR0ZXJuID0gZGVmYXVsdEN1c3RvbUdyYW1tYXIuZ2V0TGV4aWNhbFBhdHRlcm4oKSxcbiAgICAgICAgZGVmYXVsdExleGljYWxQYXR0ZXJuID0gZGVmYXVsdEN1c3RvbUdyYW1tYXJMZXhpY2FsUGF0dGVybjsgLy8vXG5cbiAgbGV4aWNhbFBhdHRlcm5zLnJldmVyc2UoKTtcblxuICBsZXhpY2FsUGF0dGVybnMucHVzaChkZWZhdWx0TGV4aWNhbFBhdHRlcm4pO1xuXG4gIGZpbHRlcihsZXhpY2FsUGF0dGVybnMsIChsZXhpY2FsUGF0dGVybikgPT4ge1xuICAgIGlmIChsZXhpY2FsUGF0dGVybiAhPT0gRU1QVFlfU1RSSU5HKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH0pO1xuXG4gIGNvbnN0IGxleGljYWxQYXR0ZXJuc1N0cmluZyA9IGxleGljYWxQYXR0ZXJucy5qb2luKFwifFwiKSwgLy8vXG4gICAgICAgIGxleGljYWxQYXR0ZXJuID0gYF4oPzoke2xleGljYWxQYXR0ZXJuc1N0cmluZ30pYDtcblxuICByZXR1cm4gbGV4aWNhbFBhdHRlcm47XG59XG5cbmZ1bmN0aW9uIHN0YXJ0UnVsZUZyb21Ob3RoaW5nKCkge1xuICBjb25zdCBzdGFydFJ1bGVzQk5GID0gYCAke1NUQVJUX1JVTEVfTkFNRX0gOjo9ICR7TUVUQVNUQVRFTUVOVF9SVUxFX05BTUV9IHwgJHtTVEFURU1FTlRfUlVMRV9OQU1FfSB8ICR7RVhQUkVTU0lPTl9SVUxFX05BTUV9IHwgJHtURVJNX1JVTEVfTkFNRX0gOyBgLFxuICAgICAgICBzdGFydFJ1bGVzID0gcnVsZXNGcm9tQk5GKHN0YXJ0UnVsZXNCTkYpLFxuICAgICAgICBmaXJzdFN0YXJ0UnVsZSA9IGZpcnN0KHN0YXJ0UnVsZXMpLFxuICAgICAgICBzdGFydFJ1bGUgPSBmaXJzdFN0YXJ0UnVsZTsgLy8vXG5cbiAgcmV0dXJuIHN0YXJ0UnVsZTtcbn1cblxuZnVuY3Rpb24gcmVtYWluaW5nUnVsZXNGcm9tUnVsZXNBbmRNYWluUnVsZShydWxlcywgbWFpblJ1bGUpIHtcbiAgY29uc3QgcmVtYWluaW5nUnVsZXMgPSBydWxlcy5maWx0ZXIoKHJ1bGUpID0+IHtcbiAgICBpZiAocnVsZSAhPT0gbWFpblJ1bGUpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuIHJlbWFpbmluZ1J1bGVzO1xufVxuXG5mdW5jdGlvbiBtYWluUnVsZUZyb21SdWxlTmFtZURlZmF1bHRCTkZBbmRCTkZzKHJ1bGVOYW1lLCBibmZzKSB7XG4gIGNvbnN0IGRlZmF1bHRDdXN0b21HcmFtbWFyQk5GID0gZGVmYXVsdEN1c3RvbUdyYW1tYXIuZ2V0Qk5GKHJ1bGVOYW1lKSxcbiAgICAgICAgZGVmYXVsdEJORiA9IGRlZmF1bHRDdXN0b21HcmFtbWFyQk5GLCAvLy9cbiAgICAgICAgZGVmYXVsdFJ1bGVzID0gcnVsZXNGcm9tQk5GKGRlZmF1bHRCTkYpLFxuICAgICAgICBkZWZhdWx0TWFpblJ1bGUgPSBmaW5kUnVsZUJ5UnVsZU5hbWUocnVsZU5hbWUsIGRlZmF1bHRSdWxlcyksXG4gICAgICAgIGRlZmF1bHRNYWluUnVsZURlZmluaXRpb25zID0gZGVmYXVsdE1haW5SdWxlLmdldERlZmluaXRpb25zKCk7XG5cbiAgYm5mcy5mb3JFYWNoKChibmYpID0+IHtcbiAgICBjb25zdCBydWxlcyA9IHJ1bGVzRnJvbUJORihibmYpLFxuICAgICAgICAgIG1haW5SdWxlID0gZmluZFJ1bGVCeVJ1bGVOYW1lKHJ1bGVOYW1lLCBydWxlcyksXG4gICAgICAgICAgbWFpblJ1bGVEZWZpbml0aW9ucyA9IChtYWluUnVsZSAhPT0gbnVsbCkgP1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1haW5SdWxlLmdldERlZmluaXRpb25zKCkgOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW107XG5cbiAgICB1bnNoaWZ0KGRlZmF1bHRNYWluUnVsZURlZmluaXRpb25zLCBtYWluUnVsZURlZmluaXRpb25zKTtcbiAgfSk7XG5cbiAgY29uc3QgbWFpblJ1bGUgPSBkZWZhdWx0TWFpblJ1bGU7IC8vL1xuXG4gIHJldHVybiBtYWluUnVsZTtcbn1cblxuZnVuY3Rpb24gcmVtYWluaW5nUnVsZXNGcm9tUnVsZU5hbWVEZWZhdWx0Qk5GQW5kQk5GcyhydWxlTmFtZSwgYm5mcykge1xuICBjb25zdCBkZWZhdWx0Q3VzdG9tR3JhbW1hckJORiA9IGRlZmF1bHRDdXN0b21HcmFtbWFyLmdldEJORihydWxlTmFtZSksXG4gICAgICAgIGRlZmF1bHRCTkYgPSBkZWZhdWx0Q3VzdG9tR3JhbW1hckJORiwgLy8vXG4gICAgICAgIGRlZmF1bHRSdWxlcyA9IHJ1bGVzRnJvbUJORihkZWZhdWx0Qk5GKSxcbiAgICAgICAgZGVmYXVsdE1haW5SdWxlID0gZmluZFJ1bGVCeVJ1bGVOYW1lKHJ1bGVOYW1lLCBkZWZhdWx0UnVsZXMpLFxuICAgICAgICBkZWZhdWx0UmVtYWluaW5nUnVsZXMgPSByZW1haW5pbmdSdWxlc0Zyb21SdWxlc0FuZE1haW5SdWxlKGRlZmF1bHRSdWxlcywgZGVmYXVsdE1haW5SdWxlKTtcblxuICBibmZzLmZvckVhY2goKGJuZikgPT4ge1xuICAgIGNvbnN0IHJ1bGVzID0gcnVsZXNGcm9tQk5GKGJuZiksXG4gICAgICAgICAgbWFpblJ1bGUgPSBmaW5kUnVsZUJ5UnVsZU5hbWUocnVsZU5hbWUsIHJ1bGVzKSxcbiAgICAgICAgICByZW1haW5pbmdSdWxlcyA9IHJlbWFpbmluZ1J1bGVzRnJvbVJ1bGVzQW5kTWFpblJ1bGUocnVsZXMsIG1haW5SdWxlKTtcblxuICAgIHVuc2hpZnQoZGVmYXVsdFJlbWFpbmluZ1J1bGVzLCByZW1haW5pbmdSdWxlcyk7XG4gIH0pO1xuXG4gIGNvbnN0IHJlbWFpbmluZ1J1bGVzID0gZGVmYXVsdFJlbWFpbmluZ1J1bGVzOyAvLy9cblxuICByZXR1cm4gcmVtYWluaW5nUnVsZXM7XG59XG5cbmZ1bmN0aW9uIHJ1bGVzRnJvbVJ1bGVOYW1lQ3VzdG9tR3JhbW1hcnNBbmREZWZhdWx0Qk5GKHJ1bGVOYW1lLCBjdXN0b21HcmFtbWFycykge1xuICBjb25zdCBibmZzID0gYm5mc0Zyb21SdWxlTmFtZUFuZEN1c3RvbUdyYW1tYXJzKHJ1bGVOYW1lLCBjdXN0b21HcmFtbWFycyksXG4gICAgICAgIG1haW5SdWxlID0gbWFpblJ1bGVGcm9tUnVsZU5hbWVEZWZhdWx0Qk5GQW5kQk5GcyhydWxlTmFtZSwgYm5mcyksXG4gICAgICAgIHJlbWFpbmluZ1J1bGVzID0gcmVtYWluaW5nUnVsZXNGcm9tUnVsZU5hbWVEZWZhdWx0Qk5GQW5kQk5GcyhydWxlTmFtZSwgYm5mcyksXG4gICAgICAgIHJ1bGVzID0gW10uY29uY2F0KG1haW5SdWxlKS5jb25jYXQocmVtYWluaW5nUnVsZXMpO1xuXG4gIHJldHVybiBydWxlcztcbn1cbiJdLCJuYW1lcyI6WyJmaXJzdCIsImFycmF5VXRpbGl0aWVzIiwiZmlsdGVyIiwidW5zaGlmdCIsIkNvbWJpbmVkQ3VzdG9tR3JhbW1hciIsImxleGljYWxQYXR0ZXJuIiwicnVsZU1hcCIsImdldExleGljYWxQYXR0ZXJuIiwiZ2V0UnVsZU1hcCIsImZyb21DdXN0b21HcmFtbWFycyIsImN1c3RvbUdyYW1tYXJzIiwibWV0YXN0YXRlbWVudFJ1bGVzIiwibWV0YXN0YXRlbWVudFJ1bGVzRnJvbUN1c3RvbUdyYW1tYXJzQW5kRGVmYXVsdEJORiIsInN0YXRlbWVudFJ1bGVzIiwic3RhdGVtZW50UnVsZXNGcm9tQ3VzdG9tR3JhbW1hcnNBbmREZWZhdWx0Qk5GIiwiZXhwcmVzc2lvblJ1bGVzIiwiZXhwcmVzc2lvblJ1bGVzRnJvbUN1c3RvbUdyYW1tYXJzQW5kRGVmYXVsdEJORiIsInRlcm1SdWxlcyIsInRlcm1SdWxlc0Zyb21DdXN0b21HcmFtbWFyc0FuZERlZmF1bHRCTkYiLCJydWxlcyIsImNvbmNhdCIsInN0YXJ0UnVsZSIsInN0YXJ0UnVsZUZyb21Ob3RoaW5nIiwibGV4aWNhbFBhdHRlcm5Gcm9tQ3VzdG9tR3JhbW1hcnMiLCJydWxlTWFwRnJvbVJ1bGVzIiwiU1RBUlRfUlVMRV9OQU1FIiwiZWxpbWluYXRlTGVmdFJlY3Vyc2lvbiIsImNvbWJpbmVkQ3VzdG9tR3JhbW1hciIsIm1ldGFzdGF0ZW1lbnRSdWxlTmFtZSIsIk1FVEFTVEFURU1FTlRfUlVMRV9OQU1FIiwicnVsZXNGcm9tUnVsZU5hbWVDdXN0b21HcmFtbWFyc0FuZERlZmF1bHRCTkYiLCJzdGF0ZW1lbnRSdWxlTmFtZSIsIlNUQVRFTUVOVF9SVUxFX05BTUUiLCJleHByZXNzaW9uUnVsZU5hbWUiLCJFWFBSRVNTSU9OX1JVTEVfTkFNRSIsInRlcm1SdWxlTmFtZSIsIlRFUk1fUlVMRV9OQU1FIiwibGV4aWNhbFBhdHRlcm5zIiwibGV4aWNhbFBhdHRlcm5zRnJvbUN1c3RvbUdyYW1tYXJzIiwiZGVmYXVsdEN1c3RvbUdyYW1tYXJMZXhpY2FsUGF0dGVybiIsImRlZmF1bHRDdXN0b21HcmFtbWFyIiwiZGVmYXVsdExleGljYWxQYXR0ZXJuIiwicmV2ZXJzZSIsInB1c2giLCJFTVBUWV9TVFJJTkciLCJsZXhpY2FsUGF0dGVybnNTdHJpbmciLCJqb2luIiwic3RhcnRSdWxlc0JORiIsInN0YXJ0UnVsZXMiLCJydWxlc0Zyb21CTkYiLCJmaXJzdFN0YXJ0UnVsZSIsInJlbWFpbmluZ1J1bGVzRnJvbVJ1bGVzQW5kTWFpblJ1bGUiLCJtYWluUnVsZSIsInJlbWFpbmluZ1J1bGVzIiwicnVsZSIsIm1haW5SdWxlRnJvbVJ1bGVOYW1lRGVmYXVsdEJORkFuZEJORnMiLCJydWxlTmFtZSIsImJuZnMiLCJkZWZhdWx0Q3VzdG9tR3JhbW1hckJORiIsImdldEJORiIsImRlZmF1bHRCTkYiLCJkZWZhdWx0UnVsZXMiLCJkZWZhdWx0TWFpblJ1bGUiLCJmaW5kUnVsZUJ5UnVsZU5hbWUiLCJkZWZhdWx0TWFpblJ1bGVEZWZpbml0aW9ucyIsImdldERlZmluaXRpb25zIiwiZm9yRWFjaCIsImJuZiIsIm1haW5SdWxlRGVmaW5pdGlvbnMiLCJyZW1haW5pbmdSdWxlc0Zyb21SdWxlTmFtZURlZmF1bHRCTkZBbmRCTkZzIiwiZGVmYXVsdFJlbWFpbmluZ1J1bGVzIiwiYm5mc0Zyb21SdWxlTmFtZUFuZEN1c3RvbUdyYW1tYXJzIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUFZLENBQUM7OztFQUFiO3dCQUFBO0FBRStCLElBQUEsVUFBVyxXQUFYLFdBQVcsQ0FBQTtBQUNILElBQUEsc0JBQXlCLFdBQXpCLHlCQUF5QixDQUFBO0FBRS9CLElBQUEscUJBQXdCLGtDQUF4Qix3QkFBd0IsRUFBQTtBQUU1QixJQUFBLFVBQWEsV0FBYixhQUFhLENBQUE7QUFDUCxJQUFBLFNBQXNCLFdBQXRCLHNCQUFzQixDQUFBO0FBQ1YsSUFBQSxNQUFtQixXQUFuQixtQkFBbUIsQ0FBQTtBQUNtQixJQUFBLGVBQTRCLFdB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