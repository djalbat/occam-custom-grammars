'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var parsers = require('occam-parsers'),
    ///
necessary = require('necessary'),
    grammarUtilities = require('occam-grammar-utilities'); ///

var rulesUtilities = require('./utilities/rules'),
    ruleNameUtilities = require('./utilities/ruleName'),
    customGrammarsUtilities = require('./utilities/customGrammars');

var rulesFromBNF = rulesUtilities.rulesFromBNF,
    arrayUtilities = necessary.arrayUtilities,
    first = arrayUtilities.first,
    unshift = arrayUtilities.unshift,
    eliminateImplicitLeftRecursion = grammarUtilities.eliminateImplicitLeftRecursion,
    lexicalPatternsFromCustomGrammars = customGrammarsUtilities.lexicalPatternsFromCustomGrammars,
    bnfsFromRuleNameAndCustomGrammars = customGrammarsUtilities.bnfsFromRuleNameAndCustomGrammars,
    termDefaultCustomGrammarBNF = parsers.termDefaultCustomGrammarBNF,
    statementDefaultCustomGrammarBNF = parsers.statementDefaultCustomGrammarBNF,
    expressionDefaultCustomGrammarBNF = parsers.expressionDefaultCustomGrammarBNF,
    metastatementDefaultCustomGrammarBNF = parsers.metastatementDefaultCustomGrammarBNF,
    findRuleByRuleName = ruleNameUtilities.findRuleByRuleName,
    qualifiedRuleBNFFromRuleName = ruleNameUtilities.qualifiedRuleBNFFromRuleName,
    qualifiedRuleNameFromRuleName = ruleNameUtilities.qualifiedRuleNameFromRuleName,
    unqualifiedRuleBNFFromRuleName = ruleNameUtilities.unqualifiedRuleBNFFromRuleName,
    unqualifiedRuleNameFromRuleName = ruleNameUtilities.unqualifiedRuleNameFromRuleName;

var CombinedCustomGrammars = function () {
  function CombinedCustomGrammars(lexicalPattern, rules) {
    _classCallCheck(this, CombinedCustomGrammars);

    this.lexicalPattern = lexicalPattern;
    this.rules = rules;
  }

  _createClass(CombinedCustomGrammars, [{
    key: 'getLexicalPattern',
    value: function getLexicalPattern() {
      return this.lexicalPattern;
    }
  }, {
    key: 'getRules',
    value: function getRules() {
      return this.rules;
    }
  }], [{
    key: 'fromCustomGrammars',
    value: function fromCustomGrammars(customGrammars) {
      var combinedLexicalPattern = combinedLexicalPatternFromCustomGrammars(customGrammars),
          combinedRules = combinedRulesFromCustomGrammars(customGrammars),
          lexicalPattern = combinedLexicalPattern,
          ///
      rules = combinedRules,
          ///
      combinedCustomGrammars = new CombinedCustomGrammars(lexicalPattern, rules);

      return combinedCustomGrammars;
    }
  }]);

  return CombinedCustomGrammars;
}();

module.exports = CombinedCustomGrammars;

function combinedLexicalPatternFromCustomGrammars(customGrammars) {
  var lexicalPatterns = lexicalPatternsFromCustomGrammars(customGrammars),
      combinedLexicalPattern = lexicalPatterns.reverse().join('|'); ///

  return combinedLexicalPattern;
}

function combinedRulesFromCustomGrammars(customGrammars) {
  var metastatementRules = metastatementRulesFromCustomGrammars(customGrammars),
      statementRules = statementRulesFromCustomGrammars(customGrammars),
      expressionRules = expressionRulesFromCustomGrammars(customGrammars),
      termRules = termRulesFromCustomGrammars(customGrammars),
      combinedRules = [].concat(metastatementRules).concat(statementRules).concat(expressionRules).concat(termRules); ///

  return combinedRules;
}

function metastatementRulesFromCustomGrammars(customGrammars) {
  var ruleName = 'metastatement',
      ///
  defaultBNF = metastatementDefaultCustomGrammarBNF,
      ///
  bnfs = bnfsFromRuleNameAndCustomGrammars(ruleName, customGrammars),
      mainRule = mainRuleFromRuleNameDefaultBNFAndBNFs(ruleName, defaultBNF, bnfs),
      remainingRules = remainingRulesFromRuleNameDefaultBNFAndBNFs(ruleName, defaultBNF, bnfs),
      qualifiedRules = qualifiedRulesFromMainRule(mainRule),
      unqualifiedRules = unqualifiedRulesFromMainRule(mainRule);

  var rules = void 0;

  rules = [].concat(remainingRules).concat(mainRule);

  rules = eliminateImplicitLeftRecursion(rules);

  rules = [].concat(unqualifiedRules).concat(qualifiedRules).concat(rules);

  var metastatementRules = rules;

  return metastatementRules;
}

function statementRulesFromCustomGrammars(customGrammars) {
  var ruleName = 'statement',
      ///
  defaultBNF = statementDefaultCustomGrammarBNF,
      ///
  bnfs = bnfsFromRuleNameAndCustomGrammars(ruleName, customGrammars),
      mainRule = mainRuleFromRuleNameDefaultBNFAndBNFs(ruleName, defaultBNF, bnfs),
      remainingRules = remainingRulesFromRuleNameDefaultBNFAndBNFs(ruleName, defaultBNF, bnfs),
      qualifiedRules = qualifiedRulesFromMainRule(mainRule),
      unqualifiedRules = unqualifiedRulesFromMainRule(mainRule);

  var rules = void 0;

  rules = [].concat(remainingRules).concat(mainRule);

  rules = eliminateImplicitLeftRecursion(rules);

  rules = [].concat(unqualifiedRules).concat(qualifiedRules).concat(rules);

  var statementRules = rules;

  return statementRules;
}

function expressionRulesFromCustomGrammars(customGrammars) {
  var ruleName = 'expression',
      ///
  defaultBNF = expressionDefaultCustomGrammarBNF,
      ///
  bnfs = bnfsFromRuleNameAndCustomGrammars(ruleName, customGrammars),
      mainRule = mainRuleFromRuleNameDefaultBNFAndBNFs(ruleName, defaultBNF, bnfs),
      remainingRules = remainingRulesFromRuleNameDefaultBNFAndBNFs(ruleName, defaultBNF, bnfs);

  var rules = void 0;

  rules = [].concat(remainingRules).concat(mainRule);

  rules = eliminateImplicitLeftRecursion(rules);

  var expressionRules = rules;

  return expressionRules;
}

function termRulesFromCustomGrammars(customGrammars) {
  var ruleName = 'term',
      ///
  defaultBNF = termDefaultCustomGrammarBNF,
      ///
  bnfs = bnfsFromRuleNameAndCustomGrammars(ruleName, customGrammars),
      mainRule = mainRuleFromRuleNameDefaultBNFAndBNFs(ruleName, defaultBNF, bnfs),
      remainingRules = remainingRulesFromRuleNameDefaultBNFAndBNFs(ruleName, defaultBNF, bnfs);

  var rules = void 0;

  rules = [].concat(remainingRules).concat(mainRule);

  rules = eliminateImplicitLeftRecursion(rules);

  var termRules = rules;

  return termRules;
}

function remainingRulesFromRulesAndMainRule(rules, mainRule) {
  var remainingRules = rules.filter(function (rule) {
    if (rule !== mainRule) {
      return true;
    }
  });

  return remainingRules;
}

function mainRuleFromRuleNameDefaultBNFAndBNFs(ruleName, defaultBNF, bnfs) {
  var defaultRules = rulesFromBNF(defaultBNF),
      defaultMainRule = findRuleByRuleName(ruleName, defaultRules),
      defaultMainRuleDefinitions = defaultMainRule.getDefinitions();

  bnfs.forEach(function (bnf) {
    var rules = rulesFromBNF(bnf),
        mainRule = findRuleByRuleName(ruleName, rules),
        mainRuleDefinitions = mainRule !== null ? mainRule.getDefinitions() : [];

    unshift(defaultMainRuleDefinitions, mainRuleDefinitions);
  });

  var mainRule = defaultMainRule; ///

  return mainRule;
}

function remainingRulesFromRuleNameDefaultBNFAndBNFs(ruleName, defaultBNF, bnfs) {
  var defaultRules = rulesFromBNF(defaultBNF),
      defaultMainRule = findRuleByRuleName(ruleName, defaultRules),
      defaultRemainingRules = remainingRulesFromRulesAndMainRule(defaultRules, defaultMainRule);

  bnfs.forEach(function (bnf) {
    var rules = rulesFromBNF(bnf),
        mainRule = findRuleByRuleName(ruleName, rules),
        remainingRules = remainingRulesFromRulesAndMainRule(rules, mainRule);

    unshift(defaultRemainingRules, remainingRules);
  });

  var remainingRules = defaultRemainingRules; ///

  return remainingRules;
}

function qualifiedRulesFromMainRule(mainRule) {
  var mainQualifiedRule = mainQualifiedRuleFromMainRule(mainRule),
      remainingQualifiedRules = remainingQualifiedRulesFromMainRule(mainRule),
      qualifiedRules = [].concat(mainQualifiedRule).concat(remainingQualifiedRules);

  return qualifiedRules;
}

function unqualifiedRulesFromMainRule(mainRule) {
  var mainUnqualifiedRule = mainUnqualifiedRuleFromMainRule(mainRule),
      remainingUnqualifiedRules = remainingUnqualifiedRulesFromMainRule(mainRule),
      unqualifiedRules = [].concat(mainUnqualifiedRule).concat(remainingUnqualifiedRules);

  return unqualifiedRules;
}

function mainAmendedRuleFromMainRule(mainRule, callback) {
  var ruleName = mainRule.getName(),
      definitions = mainRule.getDefinitions(),
      mainAmendedRuleName = callback(ruleName),
      mainAmendedRuleNamesBNF = definitions.reduce(function (mainAmendedRuleNamesBNF, definition) {
    var parts = definition.getParts(),
        firstPart = first(parts),
        ruleNamePart = firstPart,
        ///
    ruleName = ruleNamePart.getRuleName(),
        mainAmendedRuleName = callback(ruleName);

    mainAmendedRuleNamesBNF = mainAmendedRuleNamesBNF === null ? mainAmendedRuleName : mainAmendedRuleNamesBNF + ' | ' + mainAmendedRuleName;

    return mainAmendedRuleNamesBNF;
  }, null),
      mainAmendedRuleBNF = mainAmendedRuleName + ' ::= ' + mainAmendedRuleNamesBNF + ' ;',
      mainAmendedRules = rulesFromBNF(mainAmendedRuleBNF),
      firstUnqualifiedMainRule = first(mainAmendedRules),
      mainAmendedRule = firstUnqualifiedMainRule; ///

  return mainAmendedRule;
}

function mainQualifiedRuleFromMainRule(mainRule) {
  return mainAmendedRuleFromMainRule(mainRule, qualifiedRuleNameFromRuleName);
}

function mainUnqualifiedRuleFromMainRule(mainRule) {
  return mainAmendedRuleFromMainRule(mainRule, unqualifiedRuleNameFromRuleName);
}

function remainingAmendedRulesFromMainRule(mainRule, callback) {
  var definitions = mainRule.getDefinitions(),
      remainingAmendedRulesBNF = definitions.reduce(function (remainingAmendedRulesBNF, definition) {
    var parts = definition.getParts(),
        firstPart = first(parts),
        ruleNamePart = firstPart,
        ///
    ruleName = ruleNamePart.getRuleName(),
        remainingAmendedRuleBNF = callback(ruleName);

    remainingAmendedRulesBNF = remainingAmendedRulesBNF === null ? remainingAmendedRuleBNF : remainingAmendedRulesBNF + ' ' + remainingAmendedRuleBNF;

    return remainingAmendedRulesBNF;
  }, null),
      remainingAmendedRules = rulesFromBNF(remainingAmendedRulesBNF);

  return remainingAmendedRules;
}

function remainingQualifiedRulesFromMainRule(mainRule) {
  return remainingAmendedRulesFromMainRule(mainRule, qualifiedRuleBNFFromRuleName);
}

function remainingUnqualifiedRulesFromMainRule(mainRule) {
  return remainingAmendedRulesFromMainRule(mainRule, unqualifiedRuleBNFFromRuleName);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2VzNi9jb21iaW5lZEN1c3RvbUdyYW1tYXJzLmpzIl0sIm5hbWVzIjpbInBhcnNlcnMiLCJyZXF1aXJlIiwibmVjZXNzYXJ5IiwiZ3JhbW1hclV0aWxpdGllcyIsInJ1bGVzVXRpbGl0aWVzIiwicnVsZU5hbWVVdGlsaXRpZXMiLCJjdXN0b21HcmFtbWFyc1V0aWxpdGllcyIsInJ1bGVzRnJvbUJORiIsImFycmF5VXRpbGl0aWVzIiwiZmlyc3QiLCJ1bnNoaWZ0IiwiZWxpbWluYXRlSW1wbGljaXRMZWZ0UmVjdXJzaW9uIiwibGV4aWNhbFBhdHRlcm5zRnJvbUN1c3RvbUdyYW1tYXJzIiwiYm5mc0Zyb21SdWxlTmFtZUFuZEN1c3RvbUdyYW1tYXJzIiwidGVybURlZmF1bHRDdXN0b21HcmFtbWFyQk5GIiwic3RhdGVtZW50RGVmYXVsdEN1c3RvbUdyYW1tYXJCTkYiLCJleHByZXNzaW9uRGVmYXVsdEN1c3RvbUdyYW1tYXJCTkYiLCJtZXRhc3RhdGVtZW50RGVmYXVsdEN1c3RvbUdyYW1tYXJCTkYiLCJmaW5kUnVsZUJ5UnVsZU5hbWUiLCJxdWFsaWZpZWRSdWxlQk5GRnJvbVJ1bGVOYW1lIiwicXVhbGlmaWVkUnVsZU5hbWVGcm9tUnVsZU5hbWUiLCJ1bnF1YWxpZmllZFJ1bGVCTkZGcm9tUnVsZU5hbWUiLCJ1bnF1YWxpZmllZFJ1bGVOYW1lRnJvbVJ1bGVOYW1lIiwiQ29tYmluZWRDdXN0b21HcmFtbWFycyIsImxleGljYWxQYXR0ZXJuIiwicnVsZXMiLCJjdXN0b21HcmFtbWFycyIsImNvbWJpbmVkTGV4aWNhbFBhdHRlcm4iLCJjb21iaW5lZExleGljYWxQYXR0ZXJuRnJvbUN1c3RvbUdyYW1tYXJzIiwiY29tYmluZWRSdWxlcyIsImNvbWJpbmVkUnVsZXNGcm9tQ3VzdG9tR3JhbW1hcnMiLCJjb21iaW5lZEN1c3RvbUdyYW1tYXJzIiwibW9kdWxlIiwiZXhwb3J0cyIsImxleGljYWxQYXR0ZXJucyIsInJldmVyc2UiLCJqb2luIiwibWV0YXN0YXRlbWVudFJ1bGVzIiwibWV0YXN0YXRlbWVudFJ1bGVzRnJvbUN1c3RvbUdyYW1tYXJzIiwic3RhdGVtZW50UnVsZXMiLCJzdGF0ZW1lbnRSdWxlc0Zyb21DdXN0b21HcmFtbWFycyIsImV4cHJlc3Npb25SdWxlcyIsImV4cHJlc3Npb25SdWxlc0Zyb21DdXN0b21HcmFtbWFycyIsInRlcm1SdWxlcyIsInRlcm1SdWxlc0Zyb21DdXN0b21HcmFtbWFycyIsImNvbmNhdCIsInJ1bGVOYW1lIiwiZGVmYXVsdEJORiIsImJuZnMiLCJtYWluUnVsZSIsIm1haW5SdWxlRnJvbVJ1bGVOYW1lRGVmYXVsdEJORkFuZEJORnMiLCJyZW1haW5pbmdSdWxlcyIsInJlbWFpbmluZ1J1bGVzRnJvbVJ1bGVOYW1lRGVmYXVsdEJORkFuZEJORnMiLCJxdWFsaWZpZWRSdWxlcyIsInF1YWxpZmllZFJ1bGVzRnJvbU1haW5SdWxlIiwidW5xdWFsaWZpZWRSdWxlcyIsInVucXVhbGlmaWVkUnVsZXNGcm9tTWFpblJ1bGUiLCJyZW1haW5pbmdSdWxlc0Zyb21SdWxlc0FuZE1haW5SdWxlIiwiZmlsdGVyIiwicnVsZSIsImRlZmF1bHRSdWxlcyIsImRlZmF1bHRNYWluUnVsZSIsImRlZmF1bHRNYWluUnVsZURlZmluaXRpb25zIiwiZ2V0RGVmaW5pdGlvbnMiLCJmb3JFYWNoIiwiYm5mIiwibWFpblJ1bGVEZWZpbml0aW9ucyIsImRlZmF1bHRSZW1haW5pbmdSdWxlcyIsIm1haW5RdWFsaWZpZWRSdWxlIiwibWFpblF1YWxpZmllZFJ1bGVGcm9tTWFpblJ1bGUiLCJyZW1haW5pbmdRdWFsaWZpZWRSdWxlcyIsInJlbWFpbmluZ1F1YWxpZmllZFJ1bGVzRnJvbU1haW5SdWxlIiwibWFpblVucXVhbGlmaWVkUnVsZSIsIm1haW5VbnF1YWxpZmllZFJ1bGVGcm9tTWFpblJ1bGUiLCJyZW1haW5pbmdVbnF1YWxpZmllZFJ1bGVzIiwicmVtYWluaW5nVW5xdWFsaWZpZWRSdWxlc0Zyb21NYWluUnVsZSIsIm1haW5BbWVuZGVkUnVsZUZyb21NYWluUnVsZSIsImNhbGxiYWNrIiwiZ2V0TmFtZSIsImRlZmluaXRpb25zIiwibWFpbkFtZW5kZWRSdWxlTmFtZSIsIm1haW5BbWVuZGVkUnVsZU5hbWVzQk5GIiwicmVkdWNlIiwiZGVmaW5pdGlvbiIsInBhcnRzIiwiZ2V0UGFydHMiLCJmaXJzdFBhcnQiLCJydWxlTmFtZVBhcnQiLCJnZXRSdWxlTmFtZSIsIm1haW5BbWVuZGVkUnVsZUJORiIsIm1haW5BbWVuZGVkUnVsZXMiLCJmaXJzdFVucXVhbGlmaWVkTWFpblJ1bGUiLCJtYWluQW1lbmRlZFJ1bGUiLCJyZW1haW5pbmdBbWVuZGVkUnVsZXNGcm9tTWFpblJ1bGUiLCJyZW1haW5pbmdBbWVuZGVkUnVsZXNCTkYiLCJyZW1haW5pbmdBbWVuZGVkUnVsZUJORiIsInJlbWFpbmluZ0FtZW5kZWRSdWxlcyJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7OztBQUVBLElBQU1BLFVBQVVDLFFBQVEsZUFBUixDQUFoQjtBQUFBLElBQTBDO0FBQ3BDQyxZQUFZRCxRQUFRLFdBQVIsQ0FEbEI7QUFBQSxJQUVNRSxtQkFBbUJGLFFBQVEseUJBQVIsQ0FGekIsQyxDQUU4RDs7QUFFOUQsSUFBTUcsaUJBQWlCSCxRQUFRLG1CQUFSLENBQXZCO0FBQUEsSUFDTUksb0JBQW9CSixRQUFRLHNCQUFSLENBRDFCO0FBQUEsSUFFTUssMEJBQTBCTCxRQUFRLDRCQUFSLENBRmhDOztBQUlNLElBQUVNLFlBQUYsR0FBbUJILGNBQW5CLENBQUVHLFlBQUY7QUFBQSxJQUNFQyxjQURGLEdBQ3FCTixTQURyQixDQUNFTSxjQURGO0FBQUEsSUFFRUMsS0FGRixHQUVxQkQsY0FGckIsQ0FFRUMsS0FGRjtBQUFBLElBRVNDLE9BRlQsR0FFcUJGLGNBRnJCLENBRVNFLE9BRlQ7QUFBQSxJQUdFQyw4QkFIRixHQUdxQ1IsZ0JBSHJDLENBR0VRLDhCQUhGO0FBQUEsSUFJRUMsaUNBSkYsR0FJMkVOLHVCQUozRSxDQUlFTSxpQ0FKRjtBQUFBLElBSXFDQyxpQ0FKckMsR0FJMkVQ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UUFDTUMsWUFBWTdFLE1BQU0yRSxLQUFOLENBRGxCO0FBQUEsUUFFTUcsZUFBZUQsU0FGckI7QUFBQSxRQUVnQztBQUMxQnhDLGVBQVd5QyxhQUFhQyxXQUFiLEVBSGpCO0FBQUEsUUFJTU8sMEJBQTBCbEIsU0FBUy9CLFFBQVQsQ0FKaEM7O0FBTUFnRCwrQkFBNEJBLDZCQUE2QixJQUE5QixHQUNFQyx1QkFERixHQUVNRCx3QkFGTixTQUVrQ0MsdUJBRjdEOztBQUlBLFdBQU9ELHdCQUFQO0FBQ0QsR0FaMEIsRUFZeEIsSUFad0IsQ0FEakM7QUFBQSxNQWNNRSx3QkFBd0J6RixhQUFhdUYsd0JBQWIsQ0FkOUI7O0FBZ0JBLFNBQU9FLHFCQUFQO0FBQ0Q7O0FBRUQsU0FBU3pCLG1DQUFULENBQTZDdEIsUUFBN0MsRUFBdUQ7QUFBRSxTQUFPNEMsa0NBQWtDNUMsUUFBbEMsRUFBNEM5Qiw0QkFBNUMsQ0FBUDtBQUFtRjs7QUFFNUksU0FBU3dELHFDQUFULENBQStDMUIsUUFBL0MsRUFBeUQ7QUFBRSxTQUFPNEMsa0NBQWtDNUMsUUFBbEMsRUFBNEM1Qiw4QkFBNUMsQ0FBUDtBQUFxRiIsImZpbGUiOiJjb21iaW5lZEN1c3RvbUdyYW1tYXJzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBwYXJzZXJzID0gcmVxdWlyZSgnb2NjYW0tcGFyc2VycycpLCAvLy9cbiAgICAgIG5lY2Vzc2FyeSA9IHJlcXVpcmUoJ25lY2Vzc2FyeScpLFxuICAgICAgZ3JhbW1hclV0aWxpdGllcyA9IHJlcXVpcmUoJ29jY2FtLWdyYW1tYXItdXRpbGl0aWVzJyk7ICAvLy9cblxuY29uc3QgcnVsZXNVdGlsaXRpZXMgPSByZXF1aXJlKCcuL3V0aWxpdGllcy9ydWxlcycpLFxuICAgICAgcnVsZU5hbWVVdGlsaXRpZXMgPSByZXF1aXJlKCcuL3V0aWxpdGllcy9ydWxlTmFtZScpLFxuICAgICAgY3VzdG9tR3JhbW1hcnNVdGlsaXRpZXMgPSByZXF1aXJlKCcuL3V0aWxpdGllcy9jdXN0b21HcmFtbWFycycpO1xuXG5jb25zdCB7IHJ1bGVzRnJvbUJORiB9ID0gcnVsZXNVdGlsaXRpZXMsXG4gICAgICB7IGFycmF5VXRpbGl0aWVzIH0gPSBuZWNlc3NhcnksXG4gICAgICB7IGZpcnN0LCB1bnNoaWZ0IH0gPSBhcnJheVV0aWxpdGllcyxcbiAgICAgIHsgZWxpbWluYXRlSW1wbGljaXRMZWZ0UmVjdXJzaW9uIH0gPSBncmFtbWFyVXRpbGl0aWVzLFxuICAgICAgeyBsZXhpY2FsUGF0dGVybnNGcm9tQ3VzdG9tR3JhbW1hcnMsIGJuZnNGcm9tUnVsZU5hbWVBbmRDdXN0b21HcmFtbWFycyB9ID0gY3VzdG9tR3JhbW1hcnNVdGlsaXRpZXMsXG4gICAgICB7IHRlcm1EZWZhdWx0Q3VzdG9tR3JhbW1hckJORiwgc3RhdGVtZW50RGVmYXVsdEN1c3RvbUdyYW1tYXJCTkYsIGV4cHJlc3Npb25EZWZhdWx0Q3VzdG9tR3JhbW1hckJORiwgbWV0YXN0YXRlbWVudERlZmF1bHRDdXN0b21HcmFtbWFyQk5GIH0gPSBwYXJzZXJzLFxuICAgICAgeyBmaW5kUnVsZUJ5UnVsZU5hbWUsIHF1YWxpZmllZFJ1bGVCTkZGcm9tUnVsZU5hbWUsIHF1YWxpZmllZFJ1bGVOYW1lRnJvbVJ1bGVOYW1lLCB1bnF1YWxpZmllZFJ1bGVCTkZGcm9tUnVsZU5hbWUsIHVucXVhbGlmaWVkUnVsZU5hbWVGcm9tUnVsZU5hbWUgfSA9IHJ1bGVOYW1lVXRpbGl0aWVzO1xuXG5jbGFzcyBDb21iaW5lZEN1c3RvbUdyYW1tYXJzIHtcbiAgY29uc3RydWN0b3IobGV4aWNhbFBhdHRlcm4sIHJ1bGVzKSB7XG4gICAgdGhpcy5sZXhpY2FsUGF0dGVybiA9IGxleGljYWxQYXR0ZXJuO1xuICAgIHRoaXMucnVsZXMgPSBydWxlcztcbiAgfVxuICBcbiAgZ2V0TGV4aWNhbFBhdHRlcm4oKSB7XG4gICAgcmV0dXJuIHRoaXMubGV4aWNhbFBhdHRlcm47XG4gIH1cblxuICBnZXRSdWxlcygpIHtcbiAgICByZXR1cm4gdGhpcy5ydWxlcztcbiAgfVxuXG4gIHN0YXRpYyBmcm9tQ3VzdG9tR3JhbW1hcnMoY3VzdG9tR3JhbW1hcnMpIHtcbiAgICBjb25zdCBjb21iaW5lZExleGljYWxQYXR0ZXJuID0gY29tYmluZWRMZXhpY2FsUGF0dGVybkZyb21DdXN0b21HcmFtbWFycyhjdXN0b21HcmFtbWFycyksXG4gICAgICAgICAgY29tYmluZWRSdWxlcyA9IGNvbWJpbmVkUnVsZXNGcm9tQ3VzdG9tR3JhbW1hcnMoY3VzdG9tR3JhbW1hcnMpLFxuICAgICAgICAgIGxleGljYWxQYXR0ZXJuID0gY29tYmluZWRMZXhpY2FsUGF0dGVybiwgIC8vL1xuICAgICAgICAgIHJ1bGVzID0gY29tYmluZWRSdWxlcywgIC8vL1xuICAgICAgICAgIGNvbWJpbmVkQ3VzdG9tR3JhbW1hcnMgPSBuZXcgQ29tYmluZWRDdXN0b21HcmFtbWFycyhsZXhpY2FsUGF0dGVybiwgcnVsZXMpO1xuICAgIFxuICAgIHJldHVybiBjb21iaW5lZEN1c3RvbUdyYW1tYXJzO1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gQ29tYmluZWRDdXN0b21HcmFtbWFycztcblxuZnVuY3Rpb24gY29tYmluZWRMZXhpY2FsUGF0dGVybkZyb21DdXN0b21HcmFtbWFycyhjdXN0b21HcmFtbWFycykge1xuICBjb25zdCBsZXhpY2FsUGF0dGVybnMgPSBsZXhpY2FsUGF0dGVybnNGcm9tQ3VzdG9tR3JhbW1hcnMoY3VzdG9tR3JhbW1hcnMpLFxuICAgICAgICBjb21iaW5lZExleGljYWxQYXR0ZXJuID0gbGV4aWNhbFBhdHRlcm5zLnJldmVyc2UoKS5qb2luKCd8Jyk7IC8vL1xuXG4gIHJldHVybiBjb21iaW5lZExleGljYWxQYXR0ZXJuO1xufVxuXG5mdW5jdGlvbiBjb21iaW5lZFJ1bGVzRnJvbUN1c3RvbUdyYW1tYXJzKGN1c3RvbUdyYW1tYXJzKSB7XG4gIGNvbnN0IG1ldGFzdGF0ZW1lbnRSdWxlcyA9IG1ldGFzdGF0ZW1lbnRSdWxlc0Zyb21DdXN0b21HcmFtbWFycyhjdXN0b21HcmFtbWFycyksXG4gICAgICAgIHN0YXRlbWVudFJ1bGVzID0gc3RhdGVtZW50UnVsZXNGcm9tQ3VzdG9tR3JhbW1hcnMoY3VzdG9tR3JhbW1hcnMpLFxuICAgICAgICBleHByZXNzaW9uUnVsZXMgPSBleHByZXNzaW9uUnVsZXNGcm9tQ3VzdG9tR3JhbW1hcnMoY3VzdG9tR3JhbW1hcnMpLFxuICAgICAgICB0ZXJtUnVsZXMgPSB0ZXJtUnVsZXNGcm9tQ3VzdG9tR3JhbW1hcnMoY3VzdG9tR3JhbW1hcnMpLFxuICAgICAgICBjb21iaW5lZFJ1bGVzID0gW10uY29uY2F0KG1ldGFzdGF0ZW1lbnRSdWxlcykuY29uY2F0KHN0YXRlbWVudFJ1bGVzKS5jb25jYXQoZXhwcmVzc2lvblJ1bGVzKS5jb25jYXQodGVybVJ1bGVzKTsgLy8vXG5cbiAgcmV0dXJuIGNvbWJpbmVkUnVsZXM7XG59XG5cbmZ1bmN0aW9uIG1ldGFzdGF0ZW1lbnRSdWxlc0Zyb21DdXN0b21HcmFtbWFycyhjdXN0b21HcmFtbWFycykge1xuICBjb25zdCBydWxlTmFtZSA9ICdtZXRhc3RhdGVtZW50JywgLy8vXG4gICAgICAgIGRlZmF1bHRCTkYgPSBtZXRhc3RhdGVtZW50RGVmYXVsdEN1c3RvbUdyYW1tYXJCTkYsIC8vL1xuICAgICAgICBibmZzID0gYm5mc0Zyb21SdWxlTmFtZUFuZEN1c3RvbUdyYW1tYXJzKHJ1bGVOYW1lLCBjdXN0b21HcmFtbWFycyksXG4gICAgICAgIG1haW5SdWxlID0gbWFpblJ1bGVGcm9tUnVsZU5hbWVEZWZhdWx0Qk5GQW5kQk5GcyhydWxlTmFtZSwgZGVmYXVsdEJORiwgYm5mcyksXG4gICAgICAgIHJlbWFpbmluZ1J1bGVzID0gcmVtYWluaW5nUnVsZXNGcm9tUnVsZU5hbWVEZWZhdWx0Qk5GQW5kQk5GcyhydWxlTmFtZSwgZGVmYXVsdEJORiwgYm5mcyksXG4gICAgICAgIHF1YWxpZmllZFJ1bGVzID0gcXVhbGlmaWVkUnVsZXNGcm9tTWFpblJ1bGUobWFpblJ1bGUpLFxuICAgICAgICB1bnF1YWxpZmllZFJ1bGVzID0gdW5xdWFsaWZpZWRSdWxlc0Zyb21NYWluUnVsZShtYWluUnVsZSk7XG5cbiAgbGV0IHJ1bGVzO1xuXG4gIHJ1bGVzID0gW10uY29uY2F0KHJlbWFpbmluZ1J1bGVzKS5jb25jYXQobWFpblJ1bGUpO1xuXG4gIHJ1bGVzID0gZWxpbWluYXRlSW1wbGljaXRMZWZ0UmVjdXJzaW9uKHJ1bGVzKTtcblxuICBydWxlcyA9IFtdLmNvbmNhdCh1bnF1YWxpZmllZFJ1bGVzKS5jb25jYXQocXVhbGlmaWVkUnVsZXMpLmNvbmNhdChydWxlcyk7XG5cbiAgY29uc3QgbWV0YXN0YXRlbWVudFJ1bGVzID0gcnVsZXM7XG5cbiAgcmV0dXJuIG1ldGFzdGF0ZW1lbnRSdWxlcztcbn1cblxuZnVuY3Rpb24gc3RhdGVtZW50UnVsZXNGcm9tQ3VzdG9tR3JhbW1hcnMoY3VzdG9tR3JhbW1hcnMpIHtcbiAgY29uc3QgcnVsZU5hbWUgPSAnc3RhdGVtZW50JywgLy8vXG4gICAgICAgIGRlZmF1bHRCTkYgPSBzdGF0ZW1lbnREZWZhdWx0Q3VzdG9tR3JhbW1hckJORiwgLy8vXG4gICAgICAgIGJuZnMgPSBibmZzRnJvbVJ1bGVOYW1lQW5kQ3VzdG9tR3JhbW1hcnMocnVsZU5hbWUsIGN1c3RvbUdyYW1tYXJzKSxcbiAgICAgICAgbWFpblJ1bGUgPSBtYWluUnVsZUZyb21SdWxlTmFtZURlZmF1bHRCTkZBbmRCTkZzKHJ1bGVOYW1lLCBkZWZhdWx0Qk5GLCBibmZzKSxcbiAgICAgICAgcmVtYWluaW5nUnVsZXMgPSByZW1haW5pbmdSdWxlc0Zyb21SdWxlTmFtZURlZmF1bHRCTkZBbmRCTkZzKHJ1bGVOYW1lLCBkZWZhdWx0Qk5GLCBibmZzKSxcbiAgICAgICAgcXVhbGlmaWVkUnVsZXMgPSBxdWFsaWZpZWRSdWxlc0Zyb21NYWluUnVsZShtYWluUnVsZSksXG4gICAgICAgIHVucXVhbGlmaWVkUnVsZXMgPSB1bnF1YWxpZmllZFJ1bGVzRnJvbU1haW5SdWxlKG1haW5SdWxlKTtcblxuICBsZXQgcnVsZXM7XG5cbiAgcnVsZXMgPSBbXS5jb25jYXQocmVtYWluaW5nUnVsZXMpLmNvbmNhdChtYWluUnVsZSk7XG5cbiAgcnVsZXMgPSBlbGltaW5hdGVJbXBsaWNpdExlZnRSZWN1cnNpb24ocnVsZXMpO1xuXG4gIHJ1bGVzID0gW10uY29uY2F0KHVucXVhbGlmaWVkUnVsZXMpLmNvbmNhdChxdWFsaWZpZWRSdWxlcykuY29uY2F0KHJ1bGVzKTtcblxuICBjb25zdCBzdGF0ZW1lbnRSdWxlcyA9IHJ1bGVzO1xuXG4gIHJldHVybiBzdGF0ZW1lbnRSdWxlcztcbn1cblxuZnVuY3Rpb24gZXhwcmVzc2lvblJ1bGVzRnJvbUN1c3RvbUdyYW1tYXJzKGN1c3RvbUdyYW1tYXJzKSB7XG4gIGNvbnN0IHJ1bGVOYW1lID0gJ2V4cHJlc3Npb24nLCAvLy9cbiAgICAgICAgZGVmYXVsdEJORiA9IGV4cHJlc3Npb25EZWZhdWx0Q3VzdG9tR3JhbW1hckJORiwgLy8vXG4gICAgICAgIGJuZnMgPSBibmZzRnJvbVJ1bGVOYW1lQW5kQ3VzdG9tR3JhbW1hcnMocnVsZU5hbWUsIGN1c3RvbUdyYW1tYXJzKSxcbiAgICAgICAgbWFpblJ1bGUgPSBtYWluUnVsZUZyb21SdWxlTmFtZURlZmF1bHRCTkZBbmRCTkZzKHJ1bGVOYW1lLCBkZWZhdWx0Qk5GLCBibmZzKSxcbiAgICAgICAgcmVtYWluaW5nUnVsZXMgPSByZW1haW5pbmdSdWxlc0Zyb21SdWxlTmFtZURlZmF1bHRCTkZBbmRCTkZzKHJ1bGVOYW1lLCBkZWZhdWx0Qk5GLCBibmZzKTtcblxuICBsZXQgcnVsZXM7XG5cbiAgcnVsZXMgPSBbXS5jb25jYXQocmVtYWluaW5nUnVsZXMpLmNvbmNhdChtYWluUnVsZSk7XG5cbiAgcnVsZXMgPSBlbGltaW5hdGVJbXBsaWNpdExlZnRSZWN1cnNpb24ocnVsZXMpO1xuXG4gIGNvbnN0IGV4cHJlc3Npb25SdWxlcyA9IHJ1bGVzO1xuXG4gIHJldHVybiBleHByZXNzaW9uUnVsZXM7XG59XG5cbmZ1bmN0aW9uIHRlcm1SdWxlc0Zyb21DdXN0b21HcmFtbWFycyhjdXN0b21HcmFtbWFycykge1xuICBjb25zdCBydWxlTmFtZSA9ICd0ZXJtJywgLy8vXG4gICAgICAgIGRlZmF1bHRCTkYgPSB0ZXJtRGVmYXVsdEN1c3RvbUdyYW1tYXJCTkYsIC8vL1xuICAgICAgICBibmZzID0gYm5mc0Zyb21SdWxlTmFtZUFuZEN1c3RvbUdyYW1tYXJzKHJ1bGVOYW1lLCBjdXN0b21HcmFtbWFycyksXG4gICAgICAgIG1haW5SdWxlID0gbWFpblJ1bGVGcm9tUnVsZU5hbWVEZWZhdWx0Qk5GQW5kQk5GcyhydWxlTmFtZSwgZGVmYXVsdEJORiwgYm5mcyksXG4gICAgICAgIHJlbWFpbmluZ1J1bGVzID0gcmVtYWluaW5nUnVsZXNGcm9tUnVsZU5hbWVEZWZhdWx0Qk5GQW5kQk5GcyhydWxlTmFtZSwgZGVmYXVsdEJORiwgYm5mcyk7XG5cbiAgbGV0IHJ1bGVzO1xuXG4gIHJ1bGVzID0gW10uY29uY2F0KHJlbWFpbmluZ1J1bGVzKS5jb25jYXQobWFpblJ1bGUpO1xuXG4gIHJ1bGVzID0gZWxpbWluYXRlSW1wbGljaXRMZWZ0UmVjdXJzaW9uKHJ1bGVzKTtcblxuICBjb25zdCB0ZXJtUnVsZXMgPSBydWxlcztcblxuICByZXR1cm4gdGVybVJ1bGVzO1xufVxuXG5mdW5jdGlvbiByZW1haW5pbmdSdWxlc0Zyb21SdWxlc0FuZE1haW5SdWxlKHJ1bGVzLCBtYWluUnVsZSkge1xuICBjb25zdCByZW1haW5pbmdSdWxlcyA9IHJ1bGVzLmZpbHRlcihmdW5jdGlvbihydWxlKSB7XG4gICAgaWYgKHJ1bGUgIT09IG1haW5SdWxlKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiByZW1haW5pbmdSdWxlcztcbn1cblxuZnVuY3Rpb24gbWFpblJ1bGVGcm9tUnVsZU5hbWVEZWZhdWx0Qk5GQW5kQk5GcyhydWxlTmFtZSwgZGVmYXVsdEJORiwgYm5mcykge1xuICBjb25zdCBkZWZhdWx0UnVsZXMgPSBydWxlc0Zyb21CTkYoZGVmYXVsdEJORiksXG4gICAgICAgIGRlZmF1bHRNYWluUnVsZSA9IGZpbmRSdWxlQnlSdWxlTmFtZShydWxlTmFtZSwgZGVmYXVsdFJ1bGVzKSxcbiAgICAgICAgZGVmYXVsdE1haW5SdWxlRGVmaW5pdGlvbnMgPSBkZWZhdWx0TWFpblJ1bGUuZ2V0RGVmaW5pdGlvbnMoKTtcblxuICBibmZzLmZvckVhY2goZnVuY3Rpb24oYm5mKSB7XG4gICAgY29uc3QgcnVsZXMgPSBydWxlc0Zyb21CTkYoYm5mKSxcbiAgICAgICAgICBtYWluUnVsZSA9IGZpbmRSdWxlQnlSdWxlTmFtZShydWxlTmFtZSwgcnVsZXMpLFxuICAgICAgICAgIG1haW5SdWxlRGVmaW5pdGlvbnMgPSAobWFpblJ1bGUgIT09IG51bGwpID9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYWluUnVsZS5nZXREZWZpbml0aW9ucygpIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtdO1xuXG4gICAgdW5zaGlmdChkZWZhdWx0TWFpblJ1bGVEZWZpbml0aW9ucywgbWFpblJ1bGVEZWZpbml0aW9ucyk7XG4gIH0pO1xuXG4gIGNvbnN0IG1haW5SdWxlID0gZGVmYXVsdE1haW5SdWxlOyAvLy9cblxuICByZXR1cm4gbWFpblJ1bGU7XG59XG5cbmZ1bmN0aW9uIHJlbWFpbmluZ1J1bGVzRnJvbVJ1bGVOYW1lRGVmYXVsdEJORkFuZEJORnMocnVsZU5hbWUsIGRlZmF1bHRCTkYsIGJuZnMpIHtcbiAgY29uc3QgZGVmYXVsdFJ1bGVzID0gcnVsZXNGcm9tQk5GKGRlZmF1bHRCTkYpLFxuICAgICAgICBkZWZhdWx0TWFpblJ1bGUgPSBmaW5kUnVsZUJ5UnVsZU5hbWUocnVsZU5hbWUsIGRlZmF1bHRSdWxlcyksXG4gICAgICAgIGRlZmF1bHRSZW1haW5pbmdSdWxlcyA9IHJlbWFpbmluZ1J1bGVzRnJvbVJ1bGVzQW5kTWFpblJ1bGUoZGVmYXVsdFJ1bGVzLCBkZWZhdWx0TWFpblJ1bGUpO1xuXG4gIGJuZnMuZm9yRWFjaChmdW5jdGlvbihibmYpIHtcbiAgICBjb25zdCBydWxlcyA9IHJ1bGVzRnJvbUJORihibmYpLFxuICAgICAgICAgIG1haW5SdWxlID0gZmluZFJ1bGVCeVJ1bGVOYW1lKHJ1bGVOYW1lLCBydWxlcyksXG4gICAgICAgICAgcmVtYWluaW5nUnVsZXMgPSByZW1haW5pbmdSdWxlc0Zyb21SdWxlc0FuZE1haW5SdWxlKHJ1bGVzLCBtYWluUnVsZSk7XG5cbiAgICB1bnNoaWZ0KGRlZmF1bHRSZW1haW5pbmdSdWxlcywgcmVtYWluaW5nUnVsZXMpO1xuICB9KTtcblxuICBjb25zdCByZW1haW5pbmdSdWxlcyA9IGRlZmF1bHRSZW1haW5pbmdSdWxlczsgLy8vXG5cbiAgcmV0dXJuIHJlbWFpbmluZ1J1bGVzO1xufVxuXG5mdW5jdGlvbiBxdWFsaWZpZWRSdWxlc0Zyb21NYWluUnVsZShtYWluUnVsZSkge1xuICBjb25zdCBtYWluUXVhbGlmaWVkUnVsZSA9IG1haW5RdWFsaWZpZWRSdWxlRnJvbU1haW5SdWxlKG1haW5SdWxlKSxcbiAgICAgICAgcmVtYWluaW5nUXVhbGlmaWVkUnVsZXMgPSByZW1haW5pbmdRdWFsaWZpZWRSdWxlc0Zyb21NYWluUnVsZShtYWluUnVsZSksXG4gICAgICAgIHF1YWxpZmllZFJ1bGVzID0gW10uY29uY2F0KG1haW5RdWFsaWZpZWRSdWxlKS5jb25jYXQocmVtYWluaW5nUXVhbGlmaWVkUnVsZXMpO1xuXG4gIHJldHVybiBxdWFsaWZpZWRSdWxlcztcbn1cblxuZnVuY3Rpb24gdW5xdWFsaWZpZWRSdWxlc0Zyb21NYWluUnVsZShtYWluUnVsZSkge1xuICBjb25zdCBtYWluVW5xdWFsaWZpZWRSdWxlID0gbWFpblVucXVhbGlmaWVkUnVsZUZyb21NYWluUnVsZShtYWluUnVsZSksXG4gICAgICAgIHJlbWFpbmluZ1VucXVhbGlmaWVkUnVsZXMgPSByZW1haW5pbmdVbnF1YWxpZmllZFJ1bGVzRnJvbU1haW5SdWxlKG1haW5SdWxlKSxcbiAgICAgICAgdW5xdWFsaWZpZWRSdWxlcyA9IFtdLmNvbmNhdChtYWluVW5xdWFsaWZpZWRSdWxlKS5jb25jYXQocmVtYWluaW5nVW5xdWFsaWZpZWRSdWxlcyk7XG5cbiAgcmV0dXJuIHVucXVhbGlmaWVkUnVsZXM7XG59XG5cbmZ1bmN0aW9uIG1haW5BbWVuZGVkUnVsZUZyb21NYWluUnVsZShtYWluUnVsZSwgY2FsbGJhY2spIHtcbiAgY29uc3QgcnVsZU5hbWUgPSBtYWluUnVsZS5nZXROYW1lKCksXG4gICAgICAgIGRlZmluaXRpb25zID0gbWFpblJ1bGUuZ2V0RGVmaW5pdGlvbnMoKSxcbiAgICAgICAgbWFpbkFtZW5kZWRSdWxlTmFtZSA9IGNhbGxiYWNrKHJ1bGVOYW1lKSxcbiAgICAgICAgbWFpbkFtZW5kZWRSdWxlTmFtZXNCTkYgPSBkZWZpbml0aW9ucy5yZWR1Y2UoZnVuY3Rpb24obWFpbkFtZW5kZWRSdWxlTmFtZXNCTkYsIGRlZmluaXRpb24pIHtcbiAgICAgICAgICBjb25zdCBwYXJ0cyA9IGRlZmluaXRpb24uZ2V0UGFydHMoKSxcbiAgICAgICAgICAgICAgICBmaXJzdFBhcnQgPSBmaXJzdChwYXJ0cyksXG4gICAgICAgICAgICAgICAgcnVsZU5hbWVQYXJ0ID0gZmlyc3RQYXJ0LCAvLy9cbiAgICAgICAgICAgICAgICBydWxlTmFtZSA9IHJ1bGVOYW1lUGFydC5nZXRSdWxlTmFtZSgpLFxuICAgICAgICAgICAgICAgIG1haW5BbWVuZGVkUnVsZU5hbWUgPSBjYWxsYmFjayhydWxlTmFtZSk7XG5cbiAgICAgICAgICBtYWluQW1lbmRlZFJ1bGVOYW1lc0JORiA9IChtYWluQW1lbmRlZFJ1bGVOYW1lc0JORiA9PT0gbnVsbCkgP1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYWluQW1lbmRlZFJ1bGVOYW1lIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAke21haW5BbWVuZGVkUnVsZU5hbWVzQk5GfSB8ICR7bWFpbkFtZW5kZWRSdWxlTmFtZX1gO1xuXG4gICAgICAgICAgcmV0dXJuIG1haW5BbWVuZGVkUnVsZU5hbWVzQk5GO1xuICAgICAgICB9LCBudWxsKSxcbiAgICAgICAgbWFpbkFtZW5kZWRSdWxlQk5GID0gYCR7bWFpbkFtZW5kZWRSdWxlTmFtZX0gOjo9ICR7bWFpbkFtZW5kZWRSdWxlTmFtZXNCTkZ9IDtgLFxuICAgICAgICBtYWluQW1lbmRlZFJ1bGVzID0gcnVsZXNGcm9tQk5GKG1haW5BbWVuZGVkUnVsZUJORiksXG4gICAgICAgIGZpcnN0VW5xdWFsaWZpZWRNYWluUnVsZSA9IGZpcnN0KG1haW5BbWVuZGVkUnVsZXMpLFxuICAgICAgICBtYWluQW1lbmRlZFJ1bGUgPSBmaXJzdFVucXVhbGlmaWVkTWFpblJ1bGU7IC8vL1xuXG4gIHJldHVybiBtYWluQW1lbmRlZFJ1bGU7XG59XG5cbmZ1bmN0aW9uIG1haW5RdWFsaWZpZWRSdWxlRnJvbU1haW5SdWxlKG1haW5SdWxlKSB7IHJldHVybiBtYWluQW1lbmRlZFJ1bGVGcm9tTWFpblJ1bGUobWFpblJ1bGUsIHF1YWxpZmllZFJ1bGVOYW1lRnJvbVJ1bGVOYW1lKTsgfVxuXG5mdW5jdGlvbiBtYWluVW5xdWFsaWZpZWRSdWxlRnJvbU1haW5SdWxlKG1haW5SdWxlKSB7IHJldHVybiBtYWluQW1lbmRlZFJ1bGVGcm9tTWFpblJ1bGUobWFpblJ1bGUsIHVucXVhbGlmaWVkUnVsZU5hbWVGcm9tUnVsZU5hbWUpOyB9XG5cbmZ1bmN0aW9uIHJlbWFpbmluZ0FtZW5kZWRSdWxlc0Zyb21NYWluUnVsZShtYWluUnVsZSwgY2FsbGJhY2spIHtcbiAgY29uc3QgZGVmaW5pdGlvbnMgPSBtYWluUnVsZS5nZXREZWZpbml0aW9ucygpLFxuICAgICAgICByZW1haW5pbmdBbWVuZGVkUnVsZXNCTkYgPSBkZWZpbml0aW9ucy5yZWR1Y2UoZnVuY3Rpb24ocmVtYWluaW5nQW1lbmRlZFJ1bGVzQk5GLCBkZWZpbml0aW9uKSB7XG4gICAgICAgICAgY29uc3QgcGFydHMgPSBkZWZpbml0aW9uLmdldFBhcnRzKCksXG4gICAgICAgICAgICAgICAgZmlyc3RQYXJ0ID0gZmlyc3QocGFydHMpLFxuICAgICAgICAgICAgICAgIHJ1bGVOYW1lUGFydCA9IGZpcnN0UGFydCwgLy8vXG4gICAgICAgICAgICAgICAgcnVsZU5hbWUgPSBydWxlTmFtZVBhcnQuZ2V0UnVsZU5hbWUoKSxcbiAgICAgICAgICAgICAgICByZW1haW5pbmdBbWVuZGVkUnVsZUJORiA9IGNhbGxiYWNrKHJ1bGVOYW1lKTtcblxuICAgICAgICAgIHJlbWFpbmluZ0FtZW5kZWRSdWxlc0JORiA9IChyZW1haW5pbmdBbWVuZGVkUnVsZXNCTkYgPT09IG51bGwpID9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbWFpbmluZ0FtZW5kZWRSdWxlQk5GIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgJHtyZW1haW5pbmdBbWVuZGVkUnVsZXNCTkZ9ICR7cmVtYWluaW5nQW1lbmRlZFJ1bGVCTkZ9YDtcblxuICAgICAgICAgIHJldHVybiByZW1haW5pbmdBbWVuZGVkUnVsZXNCTkY7XG4gICAgICAgIH0sIG51bGwpLFxuICAgICAgICByZW1haW5pbmdBbWVuZGVkUnVsZXMgPSBydWxlc0Zyb21CTkYocmVtYWluaW5nQW1lbmRlZFJ1bGVzQk5GKTtcblxuICByZXR1cm4gcmVtYWluaW5nQW1lbmRlZFJ1bGVzO1xufVxuXG5mdW5jdGlvbiByZW1haW5pbmdRdWFsaWZpZWRSdWxlc0Zyb21NYWluUnVsZShtYWluUnVsZSkgeyByZXR1cm4gcmVtYWluaW5nQW1lbmRlZFJ1bGVzRnJvbU1haW5SdWxlKG1haW5SdWxlLCBxdWFsaWZpZWRSdWxlQk5GRnJvbVJ1bGVOYW1lKTsgfVxuXG5mdW5jdGlvbiByZW1haW5pbmdVbnF1YWxpZmllZFJ1bGVzRnJvbU1haW5SdWxlKG1haW5SdWxlKSB7IHJldHVybiByZW1haW5pbmdBbWVuZGVkUnVsZXNGcm9tTWFpblJ1bGUobWFpblJ1bGUsIHVucXVhbGlmaWVkUnVsZUJORkZyb21SdWxlTmFtZSk7IH1cbiJdfQ==